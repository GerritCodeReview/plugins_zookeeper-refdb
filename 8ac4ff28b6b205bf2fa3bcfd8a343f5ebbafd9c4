{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "1cb29fb3_e41926c5",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/ZkInit.java",
        "patchSetId": 6
      },
      "lineNbr": 48,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-03-03T20:59:47Z",
      "side": 1,
      "message": "Why this optional injection is needed? Because of:\n\n  public static Injector getInjector(Injector parentInjector)\n\nRemove it and just inject them as is into ctor on line 45 below?",
      "range": {
        "startLine": 44,
        "startChar": 0,
        "endLine": 48,
        "endChar": 36
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4b1e0802_3c6c84cf",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/ZkInit.java",
        "patchSetId": 6
      },
      "lineNbr": 48,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-04T01:14:07Z",
      "side": 1,
      "message": "That won\u0027t work, because NoteDbSchemaVersionManager needs an extra binding that otherwise won\u0027t be present: AllProjectsName.\n\nThe injection is made optional so that the init won\u0027t fail loading. However, before running the step, the injector is \"completed\" and then the instance is re-injected, so that the optional injections are assigned with their values.\n\nWithout a change in Gerrit core, I could not find a better way to achieve it. DO you have other suggestions?",
      "parentUuid": "1cb29fb3_e41926c5",
      "range": {
        "startLine": 44,
        "startChar": 0,
        "endLine": 48,
        "endChar": 36
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3fea5ed_6d88c50f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/ZkInit.java",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-03-03T20:59:47Z",
      "side": 1,
      "message": "Remove it?",
      "range": {
        "startLine": 54,
        "startChar": 70,
        "endLine": 54,
        "endChar": 91
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd4fdf7d_01e87b48",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/ZkInit.java",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-04T01:14:07Z",
      "side": 1,
      "message": "It is needed and actually used at L84 as parent injector.",
      "parentUuid": "c3fea5ed_6d88c50f",
      "range": {
        "startLine": 54,
        "startChar": 70,
        "endLine": 54,
        "endChar": 91
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6767fc3_fe4ea852",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/ZkInit.java",
        "patchSetId": 6
      },
      "lineNbr": 54,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-10T21:59:25Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "bd4fdf7d_01e87b48",
      "range": {
        "startLine": 54,
        "startChar": 70,
        "endLine": 54,
        "endChar": 91
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c431c21b_a2efc438",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_182.java",
        "patchSetId": 6
      },
      "lineNbr": 27,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-03-03T20:59:47Z",
      "side": 1,
      "message": "You could inject here instead:\n\n  AllUsersNameOnInitProvider allUsersNameProvider\n\nand then say in ctor body:\n\n  this.allUsers \u003d allUsersNameProvider.get();",
      "range": {
        "startLine": 27,
        "startChar": 25,
        "endLine": 27,
        "endChar": 37
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db09da6c_5d84845b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_182.java",
        "patchSetId": 6
      },
      "lineNbr": 27,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-09T00:10:10Z",
      "side": 1,
      "message": "I tried that change, but it would make my tests so much more complicated. That is because the AllUsersName is easy to add on the init step and is available on tests as well. On the other side, AllUsersNameOnInitProvider is bound only during the init step and is quite complex to add in tests.",
      "parentUuid": "c431c21b_a2efc438",
      "range": {
        "startLine": 27,
        "startChar": 25,
        "endLine": 27,
        "endChar": 37
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "240fcecc_c77cea05",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_182.java",
        "patchSetId": 6
      },
      "lineNbr": 27,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-10T21:59:25Z",
      "side": 1,
      "message": "Marking this as resolved, unless Davido has other suggestions on how to make it simpler :-)",
      "parentUuid": "db09da6c_5d84845b",
      "range": {
        "startLine": 27,
        "startChar": 25,
        "endLine": 27,
        "endChar": 37
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4fffe3af_2665e99e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_183.java",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2021-03-03T20:59:47Z",
      "side": 1,
      "message": "You could inject here instead:\n\n  AllProjectsNameOnInitProvider allProjectsNameProvider\n\nand then say in ctor body:\n\n  this.allProjects \u003d allProjectsNameProvider.get();",
      "range": {
        "startLine": 28,
        "startChar": 25,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0f686274_5808d30a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_183.java",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-04T01:14:07Z",
      "side": 1,
      "message": "True, but what about NoteDbSchemaVersionManager? We inject that class into ZkInit and that uses:\n\n  public NoteDbSchemaVersionManager(\n      AllProjectsName allProjectsName,\n      ...)\n\nFor using AllProjectsNameOnInitProvider instead of AllProjectName we would also need to change Gerrit core, isn\u0027t it? That class is used at both init and runtime step.",
      "parentUuid": "4fffe3af_2665e99e",
      "range": {
        "startLine": 28,
        "startChar": 25,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bee66f85_6a8151f0",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/validation/dfsrefdb/zookeeper/migration/ZkMigration_Schema_183.java",
        "patchSetId": 6
      },
      "lineNbr": 28,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-03-10T21:59:25Z",
      "side": 1,
      "message": "Marking this as answered, as the suggestion won\u0027t work with NoteDbSchemaVersionManager.",
      "parentUuid": "0f686274_5808d30a",
      "range": {
        "startLine": 28,
        "startChar": 25,
        "endLine": 28,
        "endChar": 40
      },
      "revId": "8ac4ff28b6b205bf2fa3bcfd8a343f5ebbafd9c4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}